## count使用(InnoDB)

- 由于多版本并发控制(MVCC),返回的行数是无法确定的
![count计数](https://raw.githubusercontent.com/lyjgulu/mysql/main/image/count%20number.jpg)

- 优化器会找到最小的索引树去遍历。**在保证逻辑正确的前提下，尽量减少扫描的数据量，是数据库系统设计的通用法则之一。**(普通索引树比主键索引树小很多)

- 使用缓存在技术(需要类似于分布式事务机制来保障)

### 不同count性能
- count()是一个聚合函数，对于返回的结果集，一行行地判断，如果count函数的参数不是NULL，累计值就加1，否则不加。最后返回累计值。
  
- 分析性能差别的原则
  1. server层要什么就给什么；
  2. InnoDB只给必要的值；
  3. 现在的优化器只优化了count(*)的语义为“取行数”，其他“显而易见”的优化并没有做。
  
- count(主键id)
  - InnoDB引擎会遍历整张表，把每一行的id值都取出来，返回给server层。server层拿到id后，判断是不可能为空的，就按行累加。

- count(1)
  - InnoDB引擎遍历整张表，但不取值。server层对于返回的每一行，放一个数字“1”进去，判断是不可能为空的，按行累加。
  
- count(字段)
  1. 字段定义为 not null ，一行行从记录里面读出字段，判断不能为 null ，按行累加。
  2. 字段定义为 null ，执行时，判断有可能是null，再把值取出来判断，不是 null 累加。
 
- count(*)
  - mysql专门优化，可以直接使用。